#include "TCanvas.h"
#include "string"
#include "sstream"
#include "iostream"
#include "cstdio"
#include "TFile.h"
#include "TH1F.h"
#include "TChain.h"
#include "TTree.h"
#include "vector"
#include "TGraphAsymmErrors.h"
#include "TBranch.h"

void IsoCutGenLevel(){

  //loading MC to fit
  TChain mc("AnaTree");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-0to15_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-120to170_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-1400to1800_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-15to3000_TuneZ2_Flat_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-15to30_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-170to300_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-1800_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-300to470_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-30to50_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-470to800_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-50to80_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-800to1400_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_G_Pt-80to120_TuneZ2star_8TeV_pythia6.root");
	  
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_170_250_EMEnriched_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_20_30_EMEnriched_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_250_350_EMEnriched_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_30_80_EMEnriched_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_350_EMEnriched_TuneZ2star_8TeV_pythia6.root");
  mc.Add("/t3/users/meridian/GammaJets/reduced/redntp.53xv4.gjetpresel.noCorr.v1/merged/redntp_QCD_Pt_80_170_EMEnriched_TuneZ2star_8TeV_pythia6.root");


  float iso03PhotGen;
  float iRecoPhotMatchGen;
  float etaPhotGen;
  float ptPhot;
  float etaPhot;
  float weight;

  TBranch* b_iso03PhotGen;
  TBranch* b_iRecoPhotMatchGen;
  TBranch* b_etaPhotGen;
  TBranch* b_ptPhot;
  TBranch* b_etaPhot;
  TBranch* b_weight;

  mc.SetBranchAddress("iso03PhotGen", &iso03PhotGen, &b_iso03PhotGen);
  mc.SetBranchAddress("iRecoPhotMatchGen", &iRecoPhotMatchGen, &b_iRecoPhotMatchGen);
  mc.SetBranchAddress("etaPhotGen", &etaPhotGen, &b_etaPhotGen);
  mc.SetBranchAddress("ptPhot", &ptPhot, &b_ptPhot);
  mc.SetBranchAddress("etaPhot", &etaPhot, &b_etaPhot);
  mc.SetBranchAddress("weight", &weight, &b_weight);
  
  Long64_t nentries = mc.GetEntriesFast();

  TH1F* h_gen = new TH1F("h_gen", "h_gen", 25, 0., 10.);
  TH1F* h_presel = new TH1F("h_presel", "h_presel", 25, 0., 10.);

  for(Long64_t entry=0; entry<nentries; entry++){
    mc.GetEvent(entry);
    if(entry%10000==0)std::cout<<entry<<std::endl;
    if(iRecoPhotMatchGen>-1){
      if(abs(etaPhotGen)<1.4442){
	h_gen->Fill(iso03PhotGen);
      }
      if(abs(etaPhotGen)<1.4442 && ptPhot>0. ){
	h_presel->Fill(iso03PhotGen);
      }
    }

  }


  TCanvas* c1 = new TCanvas("c1", "c1", 1);

  h_gen->Draw();
  c1->SaveAs("plot_debug.png");

  h_presel->Divide(h_gen);
  
  h_presel->Draw();
  c1->SaveAs("plot_cutGenLev_GJet.root");
  c1->SaveAs("plot_cutGenLev_GJet.pdf");
  c1->SaveAs("plot_cutGenLev_GJet.png");
}

